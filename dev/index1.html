<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工单管理系统</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/element-ui/2.15.7/theme-chalk/index.min.css" rel="stylesheet">
    <script src="https://cdn.bootcdn.net/ajax/libs/vue/2.6.14/vue.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/element-ui/2.15.7/index.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/axios/0.21.1/axios.min.js"></script>
</head>
<body>
    <div id="app">
        <el-container>
            <el-header>
                <h2>工单管理系统</h2>
            </el-header>
            <el-main>
                <el-row :gutter="20">
                    <el-col :span="24">
                        <el-button type="primary" @click="showCreateDialog">创建工单</el-button>
                    </el-col>
                </el-row>
                <el-table :data="tickets" style="width: 100%; margin-top: 20px">
                    <el-table-column prop="id" label="工单ID" width="100"></el-table-column>
                    <el-table-column prop="title" label="标题"></el-table-column>
                    <el-table-column prop="priority" label="优先级" width="100">
                        <template slot-scope="scope">
                            <el-tag :type="getPriorityType(scope.row.priority)">
                                {{getPriorityText(scope.row.priority)}}
                            </el-tag>
                        </template>
                    </el-table-column>
                    <el-table-column prop="status" label="状态" width="100">
                        <template slot-scope="scope">
                            <el-tag>{{getStatusText(scope.row.status)}}</el-tag>
                        </template>
                    </el-table-column>
                    <el-table-column prop="createTime" label="创建时间" width="180"></el-table-column>
                    <el-table-column label="操作" width="200">
                        <template slot-scope="scope">
                            <el-button size="small" @click="showTransferDialog(scope.row)">转交</el-button>
                        </template>
                    </el-table-column>
                </el-table>
                
                <el-pagination
                    @current-change="handleCurrentChange"
                    :current-page="currentPage"
                    :page-size="pageSize"
                    :total="total"
                    layout="total, prev, pager, next"
                    style="margin-top: 20px">
                </el-pagination>
            </el-main>
        </el-container>

        <!-- 创建工单对话框 -->
        <el-dialog title="创建工单" :visible.sync="createDialogVisible">
            <el-form :model="ticketForm" label-width="100px">
                <el-form-item label="标题">
                    <el-input v-model="ticketForm.title"></el-input>
                </el-form-item>
                <el-form-item label="客户ID">
                    <el-input v-model="ticketForm.customerId"></el-input>
                </el-form-item>
                <el-form-item label="问题描述">
                    <el-input type="textarea" v-model="ticketForm.description"></el-input>
                </el-form-item>
                <el-form-item label="优先级">
                    <el-select v-model="ticketForm.priority">
                        <el-option label="普通" :value="0"></el-option>
                        <el-option label="中等" :value="1"></el-option>
                        <el-option label="紧急" :value="2"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="类型">
                    <el-select v-model="ticketForm.type">
                        <el-option label="咨询" :value="0"></el-option>
                        <el-option label="投诉" :value="1"></el-option>
                        <el-option label="建议" :value="2"></el-option>
                        <el-option label="其他" :value="3"></el-option>
                    </el-select>
                </el-form-item>
            </el-form>
            <div slot="footer" class="dialog-footer">
                <el-button @click="createDialogVisible = false">取 消</el-button>
                <el-button type="primary" @click="createTicket">确 定</el-button>
            </div>
        </el-dialog>

        <!-- 转交工单对话框 -->
        <el-dialog title="转交工单" :visible.sync="transferDialogVisible">
            <el-form :model="transferForm" label-width="100px">
                <el-form-item label="接收人ID">
                    <el-input v-model="transferForm.toUserId"></el-input>
                </el-form-item>
                <el-form-item label="转交原因">
                    <el-input type="textarea" v-model="transferForm.reason"></el-input>
                </el-form-item>
            </el-form>
            <div slot="footer" class="dialog-footer">
                <el-button @click="transferDialogVisible = false">取 消</el-button>
                <el-button type="primary" @click="transferTicket">确 定</el-button>
            </div>
        </el-dialog>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                tickets: [],
                currentPage: 1,
                pageSize: 10,
                total: 0,
                createDialogVisible: false,
                transferDialogVisible: false,
                ticketForm: {
                    title: '',
                    customerId: '',
                    description: '',
                    priority: 0,
                    type: 0
                },
                transferForm: {
                    ticketId: '',
                    toUserId: '',
                    reason: ''
                }
            },
            methods: {
                loadTickets() {
                    axios.get(`/api/v1/tickets?page=${this.currentPage}&size=${this.pageSize}`)
                        .then(response => {
                            this.tickets = response.data.data.items;
                            this.total = response.data.data.total;
                        });
                },
                handleCurrentChange(val) {
                    this.currentPage = val;
                    this.loadTickets();
                },
                showCreateDialog() {
                    this.createDialogVisible = true;
                },
                createTicket() {
                    axios.post('/api/v1/tickets', this.ticketForm)
                        .then(() => {
                            this.$message.success('创建成功');
                            this.createDialogVisible = false;
                            this.loadTickets();
                        });
                },
                showTransferDialog(row) {
                    this.transferForm.ticketId = row.id;
                    this.transferDialogVisible = true;
                },
                transferTicket() {
                    axios.post(`/api/v1/tickets/${this.transferForm.ticketId}/transfer`, {
                        toUserId: this.transferForm.toUserId,
                        reason: this.transferForm.reason
                    }).then(() => {
                        this.$message.success('转交成功');
                        this.transferDialogVisible = false;
                        this.loadTickets();
                    });
                },
                getPriorityText(priority) {
                    return ['普通', '中等', '紧急'][priority];
                },
                getPriorityType(priority) {
                    return ['info', 'warning', 'danger'][priority];
                },
                getStatusText(status) {
                    return ['待处理', '处理中', '已完成'][status];
                }
            },
            created() {
                this.loadTickets();
            }
        });
    </script>
</body>
</html>